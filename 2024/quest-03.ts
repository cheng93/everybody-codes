function solve1(input: string) {
    return solve(input, false);
}

function solve2(input: string) {
    return solve(input, false);
}

function solve3(input: string) {
    return solve(input, true);
}

function solve(input: string, diagonal: boolean) {
    const grid = new Map<string, number | undefined>();
    const mineable = new Set<string>();

    var splits = input.replaceAll('#', '0').split('\n');
    for (var i = 0; i < splits.length; i++) {
        const line = splits[i];
        for (var j = 0; j < line.length; j++) {
            const s = +line[j];
            const key = `${i}|${j}`;
            grid.set(key, s);
            if (s === 0) {
                mineable.add(key);
            }
        }
    }

    let mined = 0;

    while (mineable.size > 0) {
        [...mineable].filter(isNotMineable).forEach((x) => mineable.delete(x));

        mineable.forEach((x) => {
            grid.set(x, (grid.get(x) || 0) + 1);
            mined++;
        });
    }
    return mined;

    function isNotMineable(square: string): boolean {
        const layer = grid.get(square);
        const parts = square.split('|');
        const i = +parts[0];
        const j = +parts[1];
        let neighbours = [
            `${i}|${j + 1}`,
            `${i}|${j - 1}`,
            `${i + 1}|${j}`,
            `${i - 1}|${j}`,
        ];
        if (diagonal) {
            neighbours = [
                ...neighbours,
                `${i + 1}|${j + 1}`,
                `${i + 1}|${j - 1}`,
                `${i - 1}|${j + 1}`,
                `${i - 1}|${j - 1}`,
            ];
        }
        return neighbours.some(
            (neighbour) => layer && layer != grid.get(neighbour)
        );
    }
}

const example1 = `..........
..###.##..
...####...
..######..
..######..
...####...
..........`;
const example2 = example1;
const example3 = `..........
..###.##..
...####...
..######..
..######..
...####...
..........`;

console.log(solve1(example1));
console.log(solve2(example2));
console.log(solve3(example3));

const problem1 = `..............................
..............................
..............................
..............#...............
.........#.#####..####........
.........#############........
.........#############........
.........############.........
.........##############.......
...........#.#####.#..........
...........#..#.#.............
..............#...............
..............................
..............................`;
const problem2 = `......................................................................
......................................................................
.................................##.##................................
..................................####................................
..................................######..............................
............................#.....#####.......##......................
..........................#####..######.##..#####.....................
.......................########.#################.....................
.....................#..##########################....................
..................##.#############################.##.................
..................##################################..................
...................#################################..................
..................################################....................
..................################################....................
...................################################...................
....................#################################.................
....................################################..................
.....................##############..################.................
......................##############################..................
....................###############################...................
....................################################..................
....................################################..................
......................##############################..................
.......................###.########################...................
.......................#....#######################...................
.......................#..###################.#####...................
..........................#################.#.#.###...................
..............................###########.............................
..............................###########.............................
..............................######.#................................
...............................#####.#................................
................................####..................................
...................................##.................................
....................................#.................................
......................................................................`;
const problem3 = `#########################.....................................................#.......................................########################
#.#######################...........................................#.####...###.....................................#######################.#
#########################...........................................#.##########...#.................................#########################
####################.#.##.......................................#...############...#.................................#########################
######################.........................................###################.#.................................#########################
######################.........................................###################.##...............................##########################
#####################...........................................######################..............................##########################
########################........................................#####################................................#.#######################
#######################........................................#######################.#.............................#########################
######################...................................##....#########################...............................#######################
######################.................................########.########################...............................#.#####################
######################.................................#####.##########################..................................#####################
######################.................................################################.##.................................###################
#####################..................................################################.##.................................###################
####################....................................##################################.................................###################
####################...................................####################################.................................#.###..#.#########
################.#......................................###################################.................................#..###############
###############........................................#####################################................................#......###########
.#########.#..#.....................................########################################.......................................#..#####...
..#######...........................................#######################################..........................................######...
....######..........................................#######################################...........................................######..
....#..##..........................................########################################...........................................#....#..
.......##..........................................#.#######################################..................................................
.................................................###.################......####################...............................................
..................................................##################.######.###################...............................................
..................................................#################.###..###.###################..............................................
..................................................#################.###..###.###################..............................................
.....................................................###############.######.####################..............................................
..##..................................................###############......#####################..............................................
.###...#..............................................#########################################..........................................#....
########..............................................########################################..........................................##....
####..#...#...........................................########################################.........................................####...
####....###...........................................##########################################..............................###..########...
####..####.............................................######################################.................................#####.##########
.#########...............................................###################################..................................################
##########.............................................####################################...................................################
##########.................................................################################....................................###############
#############.###..........................................################################....................................###############
#############.###..........................................#################################....................................##############
####################........................................###############################..................................#.###############
####################..........................................#############################..................................#################
###################..........................................###############################..................................################
####################.........................................#############################................................####################
####################...........................................#########################.................................#####################
##################...........................................###########################................................######################
################.#............................................###########################.............................########################
##################............................................######################.####..............................#######################
#################.............................................##########.#######..######..............................########################
##################............................................###.#########.####...#..................................########################
###############................................................#...#######..####.....................................#########################
#.##############....................................................##.....#####.......................................#####################.#
#############.......................................................#.......##.#........................................######################`;

console.log(solve1(problem1));
console.log(solve2(problem2));
console.log(solve3(problem3));
